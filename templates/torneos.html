{% extends "base.html" %}

{% block title %}Torneos{% endblock %}

{% block content %}
<div class="flex justify-between items-center mb-6">
    <h2 class="text-2xl font-bold text-gray-800"><i class="bi bi-trophy"></i> Torneos</h2>
    <a href="{% url 'torneo_nuevo' %}" class="inline-flex items-center gap-2 px-4 py-2 bg-bridge text-white rounded-lg hover:bg-bridge-light transition font-medium">
        <i class="bi bi-plus-circle"></i> Nuevo Torneo
    </a>
</div>

{% if torneos %}
<div x-data="{ showDeleteModal: false, deleteFormAction: '', deleteTorneoName: '' }">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for torneo in torneos %}
        <div class="bg-white rounded-xl shadow-sm hover:shadow-md transition p-5">
            <div class="flex justify-between items-start mb-2">
                <h5 class="font-semibold text-gray-900 text-lg">{{ torneo.nombre }}</h5>
                {% if torneo.estado == 'equilibrado' %}
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">Equilibrado</span>
                {% else %}
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">Configurando</span>
                {% endif %}
            </div>
            <p class="text-gray-500 text-sm">
                <i class="bi bi-calendar"></i> {{ torneo.fecha|date:"d/m/Y" }}
            </p>
            {% if torneo.director or torneo.lugar %}
            <div class="flex flex-wrap gap-x-3 gap-y-1 text-xs text-gray-500 mt-1 mb-3">
                {% if torneo.director %}
                <span><i class="bi bi-person-badge text-bridge"></i> {{ torneo.director.nombre_completo }}</span>
                {% endif %}
                {% if torneo.lugar %}
                <span><i class="bi bi-geo-alt text-bridge"></i> {{ torneo.lugar.nombre }}</span>
                {% endif %}
            </div>
            {% else %}
            <div class="mb-3"></div>
            {% endif %}
            <div class="flex justify-between items-center">
                <span class="text-gray-500 text-sm">
                    <i class="bi bi-people"></i> {{ torneo.cantidad_parejas }} parejas
                </span>
                <div class="flex items-center gap-1">
                    <a href="{% url 'torneo_acciones' id=torneo.id %}"
                       class="p-2 text-blue-500 border border-blue-500 rounded-lg hover:bg-blue-500 hover:text-white transition" title="Abrir torneo">
                        <i class="bi bi-box-arrow-in-right"></i>
                    </a>
                    <button type="button"
                            @click="deleteFormAction = '{% url 'torneo_eliminar' id=torneo.id %}'; deleteTorneoName = '{{ torneo.nombre|escapejs }}'; showDeleteModal = true"
                            class="p-2 text-red-500 border border-red-500 rounded-lg hover:bg-red-500 hover:text-white transition" title="Eliminar">
                        <i class="bi bi-trash"></i>
                    </button>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Modal de confirmación de eliminación -->
    <div x-show="showDeleteModal"
         x-transition:enter="transition ease-out duration-200"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-150"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 z-50 flex items-center justify-center p-4"
         @keydown.escape.window="showDeleteModal = false"
         style="display: none;">
        <!-- Backdrop -->
        <div class="absolute inset-0 bg-black/50" @click="showDeleteModal = false"></div>
        <!-- Modal -->
        <div x-show="showDeleteModal"
             x-transition:enter="transition ease-out duration-200"
             x-transition:enter-start="opacity-0 scale-95"
             x-transition:enter-end="opacity-100 scale-100"
             x-transition:leave="transition ease-in duration-150"
             x-transition:leave-start="opacity-100 scale-100"
             x-transition:leave-end="opacity-0 scale-95"
             class="relative bg-white rounded-2xl shadow-xl max-w-md w-full overflow-hidden">
            <div class="p-6 text-center">
                <div class="mx-auto flex items-center justify-center h-14 w-14 rounded-full bg-red-100 mb-4">
                    <i class="bi bi-exclamation-triangle text-red-600 text-2xl"></i>
                </div>
                <h3 class="text-lg font-bold text-gray-900 mb-2">Eliminar torneo</h3>
                <p class="text-gray-500 text-sm">
                    ¿Estás seguro de que querés eliminar el torneo
                    <span class="font-semibold text-gray-700" x-text="deleteTorneoName"></span>?
                </p>
                <p class="text-gray-400 text-xs mt-1">Esta acción no se puede deshacer.</p>
            </div>
            <div class="flex border-t border-gray-200">
                <button type="button"
                        @click="showDeleteModal = false"
                        class="flex-1 px-4 py-3 text-sm font-medium text-gray-700 hover:bg-gray-50 transition">
                    Cancelar
                </button>
                <form :action="deleteFormAction" method="POST" class="flex-1 border-l border-gray-200">
                    {% csrf_token %}
                    <button type="submit"
                            class="w-full px-4 py-3 text-sm font-medium text-red-600 hover:bg-red-50 transition">
                        Eliminar
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>
{% else %}
<div class="text-center py-16">
    <i class="bi bi-trophy text-gray-300" style="font-size: 4rem;"></i>
    <p class="mt-4 text-gray-500">No hay torneos creados aún.</p>
    <a href="{% url 'torneo_nuevo' %}" class="inline-flex items-center gap-2 mt-4 px-6 py-3 bg-bridge text-white rounded-lg hover:bg-bridge-light transition font-medium">
        <i class="bi bi-plus-circle"></i> Crear Primer Torneo
    </a>
</div>
{% endif %}
{% endblock %}
